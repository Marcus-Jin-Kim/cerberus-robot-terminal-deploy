from flask import Flask, request, jsonify
from cb.move import Move
# from cb.


move = Move("WS_UGV_BEAST_PI5")

app = Flask(__name__)
app.debug = True

@app.route('/forward', methods = ['GET', 'POST'])
def forward():    
    speed = request.args.get('speed', default=0, type=float)
    duration = request.args.get('duration', default=0, type=float)
    r = move.forward(speed=speed, duration= duration)    
    return jsonify(r),200

    
@app.route('/back', methods = ['GET', 'POST'])
def backward():
    speed = request.args.get('speed', default=0, type=float)    
    duration = request.args.get('duration', default=0, type=float)
    r = move.back(speed=speed, duration=duration)
    return jsonify(r),200

@app.route('/stop', methods = ['GET', 'POST'])
def stop():
    r = move.stop()
    return jsonify(r),200

    
@app.route('/moveleft', methods = ['GET', 'POST'])
def moveleft():
    speed = request.args.get('speed', default=0, type=float)
    duration = request.args.get('duration', default=0, type=float)
    r = move.moveleft(speed=speed, duration=duration)
    return jsonify(r),200

@app.route('/moveright', methods = ['GET', 'POST'])
def moveright():
    speed = request.args.get('speed', default=0, type=float)
    duration = request.args.get('duration', default=0, type=float)
    r = move.moveright(speed=speed, duration=duration)
    return jsonify(r),200   

    
@app.route('/turnleft', methods = ['GET', 'POST'])
def turnleft():
    speed = request.args.get('speed', default=0, type=float)
    duration = request.args.get('duration', default=0, type=float)
    r = move.turnleft(speed=speed, duration=duration)
    return jsonify(r),200

    
@app.route('/turnright', methods = ['GET', 'POST'])
def turnright():
    speed = request.args.get('speed', default=0, type=float)
    duration = request.args.get('duration', default=0, type=float)
    r = move.turnright(speed=speed, duration=duration)
    return jsonify(r),200
        
    
    @app.route('/gun/shoot', methods = ['GET', 'POST'] )
    def shoot():
        gun_shoot()
        data = {}
        return jsonify(data),200
    
    @app.route('/gun/setpos', methods = ['GET', 'POST'])
    def setpos():
        global v, h
        v = int(request.args.get('v', V_INIT))
        h = int(request.args.get('h', H_INIT))

        v = v + V_INIT # apply initial offset
        h = h + H_INIT # apply initial offset

        if v < V_MIN:
            v = V_MIN
        elif v > V_MAX:
            v = V_MAX  
        if h < H_MIN:
            h = H_MIN
        elif h > H_MAX:
            h = H_MAX

        gun_setpos(v,h)
        data = {'v': v, 'h': h}
        return jsonify(data),200    

# # Example route (remove/replace as needed)
# @app.route("/ping")
# def ping():
#     return jsonify(status="ok")

if __name__ == "__main__":
    # host=0.0.0.0 to listen on all interfaces (change port if needed)
    app.run(host="0.0.0.0", port=6500)


